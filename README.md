# Otus homework 10: bulkmt

## Использование bulkmt

bulkmt имеет две опции:

`-N <size>`   - **обязательный параметр**, задающий число команд в блоке.<br>
`-T <count>`  - *опциональный параметр*, задающий число потоков записи в файлы.
                По умолчанию создается 2 потока.

Параметры можно комбинировать:

`bulkmt -N 3 -T 100`

запускает bulkmt cо 100 потоками, по 3 команды в блоке

## Описание особенностей моей реализации:

1)  Для чтения команд из стандартного ввода используется тот же код, что и в 7 задании.

2)  Потоки для вывода на консоль и в файл создаются через класс **thread_mgr**, который принимает 
    ф-ию потока, очередь сообщений и количество создаваемых потоков.

    **thread_mgr** создает нужное количество потоков, передает потокам очередь сообщений,
    получает из потоков возникшие в них исключения, и управляет счетчиками.

    Так же класс **thread_mgr** позволяет своим пользователям завершить потоки,
    созданные экземпляром этого класса
        
3)  Потоки получают сообщения через очередь сообщений, реализованных в классе **queue_tread_t**.
    Команду на завершение потоки так же получают через эту очередь.
    Очередь использует condition_variable для синхронизации доступа к ф-иям очереди.
    Таким образом запись и чтение в очередь организовано с ожиданием, что позволяет потокам не использовать
    дополнительные примитивы синхронизации, а потоко безопасно вызывать ф-ии очереди.

4)  Очередь подписывается на события готовности очередного блока команд. Но не напрямую, а через лямбду, 
    в которой вставлен дополнительный блок try/catch, что добавляет дополнительную диагностическую информацию о том, 
    чья это очередь файлового или консольного потока, в случае возникновения исключения при добавлении команды в очередь.

    Таким образом в программе используются две независимые очереди, одна для потока выводящего информацию на консоль, и одна для 
    потоков записи в файл.

5) В программе реализована обработка исключений в стиле С++11. Исключения так же перехватываются в создаваемых потоках. 
   После завершения всех потоков, возникшие ранее в потоках исключения, вновь возбуждаются в главном потоке main, где и происходит их обработка.


Документацию и дополнительное описание проекта можно найти здесь:
https://rra-roro.github.io/homework_7_bulk
